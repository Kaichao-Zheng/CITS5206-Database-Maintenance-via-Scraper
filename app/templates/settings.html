{% extends 'layout.html' %}
{% block main_content %}
<div class="flex items-center justify-center w-full h-full">
  <form id="settingsForm" method="POST" class="flex flex-col items-center justify-center" style="width:500px;background:#fff;padding:32px 24px;gap:24px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.04);">
    {{ form.hidden_tag() }}
    <div style="width:344px;">
      <label for="old_password" style="font-family:'Roboto';font-size:16px;color:rgba(0,0,0,0.87);margin-bottom:4px;">Old Password</label>
      <div style="position:relative;">
        {{ form.old_password(class="form-control", id="old_password", style="width:330px;height:54px;padding-right:40px;border:1px solid #6200EE;border-radius:4px;font-size:16px;color:rgba(0,0,0,0.87);") }}
        <span style="position:absolute;right:12px;top:16px;cursor:pointer;" onclick="togglePassword('old_password', this)">
          <svg id="eye_old_password" width="24" height="24" fill="none"><circle cx="12" cy="12" r="10" stroke="#6200EE" stroke-width="2"/><circle cx="12" cy="12" r="4" stroke="#6200EE" stroke-width="2"/></svg>
        </span>
      </div>
    </div>
    <div style="width:344px;">
      <label for="new_password" style="font-family:'Roboto';font-size:16px;color:rgba(0,0,0,0.87);margin-bottom:4px;">New Password</label>
      <div style="position:relative;">
        {{ form.new_password(class="form-control", id="new_password", style="width:330px;height:54px;padding-right:40px;border:1px solid #6200EE;border-radius:4px;font-size:16px;color:rgba(0,0,0,0.87);") }}
        <span style="position:absolute;right:12px;top:16px;cursor:pointer;" onclick="togglePassword('new_password', this)">
          <svg id="eye_new_password" width="24" height="24" fill="none"><circle cx="12" cy="12" r="10" stroke="#6200EE" stroke-width="2"/><circle cx="12" cy="12" r="4" stroke="#6200EE" stroke-width="2"/></svg>
        </span>
      </div>
    </div>
    <div style="width:344px;">
      <label for="repeat_new_password" style="font-family:'Roboto';font-size:16px;color:rgba(0,0,0,0.87);margin-bottom:4px;">Repeat New Password</label>
      <div style="position:relative;">
        {{ form.repeat_new_password(class="form-control", id="repeat_new_password", style="width:330px;height:54px;padding-right:40px;border:1px solid #6200EE;border-radius:4px;font-size:16px;color:rgba(0,0,0,0.87);") }}
        <span style="position:absolute;right:12px;top:16px;cursor:pointer;" onclick="togglePassword('repeat_new_password', this)">
          <svg id="eye_repeat_new_password" width="24" height="24" fill="none"><circle cx="12" cy="12" r="10" stroke="#6200EE" stroke-width="2"/><circle cx="12" cy="12" r="4" stroke="#6200EE" stroke-width="2"/></svg>
        </span>
      </div>
    </div>
    <div style="width:344px;">
      <div style="width:330px;height:54px;border:1px solid #6155F5;border-radius:4px;display:flex;align-items:center;justify-content:center;color:#6200EE;font-size:16px;background:#fff;">
        &lt;Password rules&gt;
      </div>
    </div>
    <div id="passwordError" style="color:red;font-size:14px;display:none;width:330px;text-align:center;"></div>
    {{ form.submit(class="button cursor-pointer w-24", style="background:#6200EE;color:#fff;font-weight:500;font-size:14px;border-radius:4px;margin-top:16px;") }}
  </form>
</div>
<script>
function togglePassword(inputId, iconSpan) {
  const input = document.getElementById(inputId);
  if (input.type === "password") {
    input.type = "text";
    iconSpan.querySelector("svg").style.opacity = 0.5;
  } else {
    input.type = "password";
    iconSpan.querySelector("svg").style.opacity = 1;
  }
}

// Frontend password consistency check
document.getElementById('settingsForm').addEventListener('submit', function(e) {
  const newPwd = document.getElementById('new_password').value;
  const repeatPwd = document.getElementById('repeat_new_password').value;
  const errorDiv = document.getElementById('passwordError');
  if (newPwd !== repeatPwd) {
    e.preventDefault();
    errorDiv.textContent = " The new password does not match the confirmation password. Please re-enter it.";
    errorDiv.style.display = "block";
  } else {
    errorDiv.style.display = "none";
  }
});
</script>
{% endblock %}
